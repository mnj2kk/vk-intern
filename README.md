# Система автоматического дополнения запросов

В данной статье рассказано о задаче и подходу к её решению

## Постановка задачи

> Написать систему автоматического дополнения запросов, которая на запрос 
пользователя будет выдавать не более 5 лучших подсказок (на основе заданого датасета)
## Подход к реализации

Основополагающим компонентом в реализации будут прямые и обратные индексы. В кратце, прямой индекс - это номер запроса в нашем датасете, а обратный индекс это слово и соответвующие ему номера запросов, в которых оно встречается. 

На введенный пользователем запрос мы будем для каждого слова (префикса) искать набор прямых индексов, в которых оно встречается и пересекать их, получая нужные набор подсказок. 

Для быстрого поиска префиксов мы будем использовать префиксное-дерево (т.к. поиск префикса в нем происходит `O(|prefix|)`).

Чтобы ранжировать наши подсказки будем сортировать изначальный датасет, таким образом, что чем выше занимает позицию запрос - тем он имеет больший приоритет.

Ранжирование происходит следующим образом:
<ol>
    <li>Сравниваются два <code>std::vector</code> содержащие наши слова. У каждого слова есть кол-во раз сколько оно встречается в запросах. </li>
    <li> Сравнение происходит вначале по кол-ву вхождений в запросы, потом лексикографически сравниваются слова. </li>
</ol>

В случае каких-то особых логов можно изменить парсер под наши нужды.

### Исправление ошибок в введенном пользователем запросе 

Для корректировки запроса будем допускать расстояние [Дамерау-Левенштейна](https://ru.wikipedia.org/wiki/%D0%A0%D0%B0%D1%81%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D0%B5_%D0%94%D0%B0%D0%BC%D0%B5%D1%80%D0%B0%D1%83_%E2%80%94_%D0%9B%D0%B5%D0%B2%D0%B5%D0%BD%D1%88%D1%82%D0%B5%D0%B9%D0%BD%D0%B0) `= 2` для слов в запросе и словаря. 

Обход нашего бора с подсчетом расстояния [Дамерау-Левенштейна](https://ru.wikipedia.org/wiki/%D0%A0%D0%B0%D1%81%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D0%B5_%D0%94%D0%B0%D0%BC%D0%B5%D1%80%D0%B0%D1%83_%E2%80%94_%D0%9B%D0%B5%D0%B2%D0%B5%D0%BD%D1%88%D1%82%D0%B5%D0%B9%D0%BD%D0%B0) и последующим поиском по наименьшей дельте расстояния.

> P.S. алгоритм [Дамерау-Левенштейна](https://ru.wikipedia.org/wiki/%D0%A0%D0%B0%D1%81%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D0%B5_%D0%94%D0%B0%D0%BC%D0%B5%D1%80%D0%B0%D1%83_%E2%80%94_%D0%9B%D0%B5%D0%B2%D0%B5%D0%BD%D1%88%D1%82%D0%B5%D0%B9%D0%BD%D0%B0) представленный в реализации проекта немного отличается от оригинального.

## Задействованые библиотеки / фреймворки / язык программирования

Основной язык программирования: `C++ 20`

Библиотеки: Стандартные библиотеки, такие как: `vector; map; string; fstream; unordered_map; sstream; etc..`

Фреймворки: не задействованы 

## Оценка эффективности данного подхода

Основная проблема данного подхода - то что все данные хранятся в RAM. На очень больших датасетах данное решение надо будет распределять на несколько серверов. Но в рамках подхода к тестовой задаче данное решение подходит.

## Тесты

Автотесты добавлены в [отдельную папку](https://github.com/mnj2kk/vk-intern/tree/main/auto_test), в случае желания запустить тесты следует заменить в CMakeList 
`suggest/suggest.cpp` на `auto_test/auto_test.cpp`

Тесты проверяют, то что:

<ol>
    <li>Полученные запросы с помощью наивной реализации и представленного подхода идентичны.</li>
    <li>Генерируются рандомные тесты на основе запросов и также изменяются слова.</li>
</ol>

## Взаимодействие пользователя и проверка работоспособности

В [данной папке](https://github.com/mnj2kk/vk-intern/tree/main/logs/пословицы) представлены логи (русские пословицы и поговорки) для проверки пользователем.

В аргументах можно подать либо полный путь до данного файла, либо `../logs/пословицы`. 

Для прекращения ввода подсказок пользователем достаточно ввести пустую строку и ввод прекратится.

## Примеры работоспоспосбности

![Работоспособность подсказок](https://github.com/mnj2kk/pictures/blob/main/vk-intern/correct_suggest.jpg)

![Работоспособность подсказок с исправление запроса](https://github.com/mnj2kk/pictures/blob/main/vk-intern/correct_answer_with_correction.jpg)

![Работоспособность отсутсвия подсказок](https://github.com/mnj2kk/pictures/blob/main/vk-intern/cant_find_something.jpg)

## Примеры работоспособности тестов

![Работоспособность тестов](https://github.com/mnj2kk/pictures/blob/main/vk-intern/auto_test_work.jpg)

## Возможные оптимизации:

<ol>
  <li> Индексы для каждого эллемента в префиксном дереве можно хранить в БД, что сэкономит оперативную память. </li>
  <li> Поддержка сжатого префиксного дерева </li>
  <li> Будут добавляться.. </li>
</ol>
